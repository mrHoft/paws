(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function s(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(a){if(a.ep)return;a.ep=!0;const o=s(a);fetch(a.href,o)}})();const be="modulepreload",we=function(l,e){return new URL(l,e).href},ee={},ve=function(e,s,n){let a=Promise.resolve();if(s&&s.length>0){let d=function(p){return Promise.all(p.map(y=>Promise.resolve(y).then(v=>({status:"fulfilled",value:v}),v=>({status:"rejected",reason:v}))))};const c=document.getElementsByTagName("link"),u=document.querySelector("meta[property=csp-nonce]"),g=u?.nonce||u?.getAttribute("nonce");a=d(s.map(p=>{if(p=we(p,n),p in ee)return;ee[p]=!0;const y=p.endsWith(".css"),v=y?'[rel="stylesheet"]':"";if(n)for(let T=c.length-1;T>=0;T--){const P=c[T];if(P.href===p&&(!y||P.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${p}"]${v}`))return;const E=document.createElement("link");if(E.rel=y?"stylesheet":be,y||(E.as="script"),E.crossOrigin="",E.href=p,g&&E.setAttribute("nonce",g),document.head.appendChild(E),y)return new Promise((T,P)=>{E.addEventListener("load",T),E.addEventListener("error",()=>P(new Error(`Unable to preload CSS for ${p}`)))})}))}function o(c){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=c,window.dispatchEvent(u),!u.defaultPrevented)throw c}return a.then(c=>{for(const u of c||[])u.status==="rejected"&&o(u.reason);return e().catch(o)})},N={GCExt:249,COMMENT:254,APPExt:255,UNKNOWN:1,IMAGE:44,EOF:59},Ee=function(){let l,e;const s=[0,4,2,1],n=[8,8,4,2];let a,o,c,u;class g{data;pos;len;constructor(i){this.data=new Uint8ClampedArray(i),this.pos=0,this.len=this.data.length}getString(i){let h="";for(;i--;)h+=String.fromCharCode(this.data[this.pos++]);return h}readSubBlocks(){let i,h,m="";do for(h=i=this.data[this.pos++];h--;)m+=String.fromCharCode(this.data[this.pos++]);while(i!==0&&this.pos<this.len);return m}readSubBlocksB(){let i,h;const m=[];do for(h=i=this.data[this.pos++];h--;)m.push(this.data[this.pos++]);while(i!==0&&this.pos<this.len);return m}}function d(r,i){let h=0,m=0,f=[];const L=1<<r,_=L+1;let k=r+1,B=!1,C,x=0;for(;!B;){C=x,x=0;for(let b=0;b<k;b++)i[h>>3]&1<<(h&7)&&(x|=1<<b),h++;if(x===L){f=[],k=r+1;for(let b=0;b<L;b++)f[b]=[b];f[L]=[],f[_]=[]}else{if(x===_){B=!0;return}x>=f.length?f.push(f[C].concat(f[C][0])):C!==L&&f.push(f[C].concat(f[x][0]));const b=f[x],I=b.length;for(let V=0;V<I;V++)u[m++]=b[V];f.length===1<<k&&k<12&&k++}}}function p(r){const i=[];for(let h=0;h<r;h++)i.push([e.data[e.pos++],e.data[e.pos++],e.data[e.pos++]]);return i}function y(){e.pos+=6,t.width=e.data[e.pos++]+(e.data[e.pos++]<<8),t.height=e.data[e.pos++]+(e.data[e.pos++]<<8);const r=e.data[e.pos++];t.colorRes=(r&112)>>4,t.globalColorCount=1<<(r&7)+1,t.bgColorIndex=e.data[e.pos++],e.pos++,r&128&&(t.globalColorTable=p(t.globalColorCount)),setTimeout(Q,0)}function v(){e.pos+=1,e.getString(8)==="NETSCAPE"?e.pos+=8:(e.pos+=3,e.readSubBlocks())}function E(){e.pos++;const r=e.data[e.pos++];t.disposalMethod=(r&28)>>2,t.transparencyGiven=!!(r&1),t.delayTime=e.data[e.pos++]+(e.data[e.pos++]<<8),t.transparencyIndex=e.data[e.pos++],e.pos++}function T(){const r=m=>{const f=c/m;let L=0;a!==c&&(o=new Uint8Array(c),a=c);for(let _=0;_<4;_++)for(let k=s[_];k<f;k+=n[_])o.set(u.subarray(L,L+m),k*m),L+=m},i={disposalMethod:t.disposalMethod,time:t.length,delay:t.delayTime*10,leftPos:0,topPos:0,width:0,height:0,localColorTableFlag:!1,interlaced:!1,image:document.createElement("canvas")};t.frames.push(i),t.length+=i.delay,t.transparencyGiven&&(i.transparencyIndex=t.transparencyIndex),i.leftPos=e.data[e.pos++]+(e.data[e.pos++]<<8),i.topPos=e.data[e.pos++]+(e.data[e.pos++]<<8),i.width=e.data[e.pos++]+(e.data[e.pos++]<<8),i.height=e.data[e.pos++]+(e.data[e.pos++]<<8);const h=e.data[e.pos++];i.localColorTableFlag=!!(h&128),i.localColorTableFlag&&(i.localColorTable=p(1<<(h&7)+1)),c!==i.width*i.height&&(u=new Uint8Array(i.width*i.height),c=i.width*i.height),d(e.data[e.pos++],e.readSubBlocksB()),h&64?(i.interlaced=!0,r(i.width)):i.interlaced=!1,P(i)}function P(r){r.image.width=t.width,r.image.height=t.height;const i=r.image.getContext("2d");r.image.ctx=i;const h=r.localColorTableFlag?r.localColorTable:t.globalColorTable;t.lastFrame===null&&(t.lastFrame=r);const m=t.lastFrame.disposalMethod===2||t.lastFrame.disposalMethod===3;m||i.drawImage(t.lastFrame.image,0,0,t.width,t.height);const f=i.getImageData(r.leftPos,r.topPos,r.width,r.height),L=r.transparencyIndex,_=f.data,k=r.interlaced?o:u,B=k.length;let C=0;for(let x=0;x<B;x++){const b=k[x],I=h[b];L!==b?(_[C++]=I[0],_[C++]=I[1],_[C++]=I[2],_[C++]=255):(m&&(_[C+3]=0),C+=4)}i.putImageData(f,r.leftPos,r.topPos),t.lastFrame=r,!t.waitTillDone&&typeof t.onload=="function"&&Z()}function S(){t.loading=!1,t.frameCount=t.frames.length,t.lastFrame=null,e=void 0,t.complete=!0,t.disposalMethod=void 0,t.transparencyGiven=void 0,t.delayTime=void 0,t.transparencyIndex=void 0,t.waitTillDone=void 0,u=void 0,o=void 0,c=void 0,o=void 0,t.currentFrame=0,t.frames.length>0&&(t.image=t.frames[0].image),Z(),typeof t.onloadall=="function"&&t.onloadall.bind(t)({type:"loadall",obj:t}),t.playOnLoad&&t.play()}function le(){S(),typeof t.cancelCallback=="function"&&t.cancelCallback.bind(t)({type:"canceled",obj:t})}function ce(){const r=e.data[e.pos++];r===N.GCExt?E():r===N.COMMENT?t.comment+=e.readSubBlocks():r===N.APPExt?v():(r===N.UNKNOWN&&(e.pos+=13),e.readSubBlocks())}function Q(){if(t.cancel===!0){le();return}const r=e.data[e.pos++];if(r===N.IMAGE){if(T(),t.firstFrameOnly){S();return}}else if(r===N.EOF){S();return}else ce();typeof t.onprogress=="function"&&t.onprogress({bytesRead:e.pos,totalBytes:e.data.length,frame:t.frames.length}),setTimeout(Q,0)}function ue(r){return t.complete?!1:(t.cancelCallback=r,t.cancel=!0,!0)}function G(r){typeof t.onerror=="function"&&t.onerror.bind(t)({type:r,obj:t}),t.onload=t.onerror=null,t.loading=!1}function Z(){t.currentFrame=0,typeof t.onload=="function"&&t.onload.bind(t)({type:"load",obj:t}),t.onerror=t.onload=null}function de(r){e=new g(r),y()}function he(r){const i=new XMLHttpRequest;i.responseType="arraybuffer",i.onload=function(h){if(h.target){const{status:m}=h.target;m===404?G("File not found"):m>=200&&m<300?de(i.response):G("Loading error : "+m)}},i.open("GET",r,!0),i.send(),i.onerror=()=>G("File error"),t.src=r,t.loading=!0}function me(){t.playing||(t.paused=!1,t.playing=!0,$())}function pe(){t.paused=!0,t.playing=!1,clearTimeout(l)}function fe(){t.paused||!t.playing?t.play():t.pause()}function ge(r){clearTimeout(l),t.currentFrame=r%t.frames.length,t.playing?$():t.image=t.frames[t.currentFrame].image}function ye(r){clearTimeout(l),r<0&&(r=0),r*=1e3,r%=t.length;let i=0;for(;r>t.frames[i].time+t.frames[i].delay&&i<t.frames.length;)i+=1;t.currentFrame=i,t.playing?$():t.image=t.frames[t.currentFrame].image}function $(){let r,i;if(t.playSpeed===0){t.pause();return}else t.playSpeed<0?(t.currentFrame-=1,t.currentFrame<0&&(t.currentFrame=t.frames.length-1),i=t.currentFrame,i-=1,i<0&&(i=t.frames.length-1),r=-t.frames[i].delay*1/t.playSpeed):(t.currentFrame+=1,t.currentFrame%=t.frames.length,r=t.frames[t.currentFrame].delay*1/t.playSpeed),t.image=t.frames[t.currentFrame].image,l=setTimeout($,r)}const t={onload:null,onerror:null,onprogress:null,onloadall:null,paused:!1,playing:!1,waitTillDone:!0,loading:!1,firstFrameOnly:!1,width:null,height:null,frames:[],comment:"",length:0,currentFrame:0,frameCount:0,playSpeed:1,lastFrame:null,image:null,playOnLoad:!0,colorRes:0,globalColorCount:0,bgColorIndex:0,disposalMethod:0,transparencyGiven:!1,delayTime:0,transparencyIndex:0,complete:!1,load:he,cancelLoad:ue,play:me,pause:pe,seek:ye,seekFrame:ge,togglePlay:fe};return t},ae=l=>l!==Object(l);function _e(l,e,s){if(ae(l))return l;if(typeof e!="string"||e=="")throw new Error("Path must be string");let n=l;const a=e.split("."),o=a.pop();return a.forEach(c=>{n[c]||(n[c]={}),n=n[c]}),n[o]=s,l}function rt(l,e){if(ae(l))return l;if(typeof e!="string"||e=="")throw new Error("Path must be string");let s=l;const n=e.split("."),a=n.pop();return n.forEach(o=>{s[o]||(s[o]={}),s=s[o]}),s[a]}const Ce=".",z={cat:"sprites/cat-ginger.gif",cactus1:"sprites/cactus1.png",cactus2:"sprites/cactus2.png",puddle:"sprites/water-puddle.png",boulder:"sprites/boulder.png",gnome:"sprites/garden-gnome.png",flowerpot:"sprites/flowerpot.png",bucket:"sprites/bucket.png",bird:"sprites/bird-yellow.gif",butterfly:"sprites/butterfly-orange.gif",grasshopper:"sprites/grasshopper.gif",mouse:"sprites/mouse-brown.gif","mountains.layer1":"scene/mountains/layer1.png","mountains.layer2":"scene/mountains/layer2.png","mountains.layer3":"scene/mountains/layer3.png","cliff.layer1":"scene/cliff/layer1.png","cliff.layer2":"scene/cliff/layer2.png","cliff.layer3":"scene/cliff/layer3.png","autumn.layer1":"scene/autumn/layer1.png","autumn.layer2":"scene/autumn/layer2.png","autumn.layer3":"scene/autumn/layer3.png","desert.layer1":"scene/desert/layer1.png","desert.layer2":"scene/desert/layer2.png","desert.layer3":"scene/desert/layer3.png","lake.layer1":"scene/lake/layer1.png","lake.layer2":"scene/lake/layer2.png","lake.layer3":"scene/lake/layer3.png","jungle.layer1":"scene/jungle/layer1.png","jungle.layer2":"scene/jungle/layer2.png","jungle.layer3":"scene/jungle/layer3.png","forest.layer1":"scene/forest/layer1.png","forest.layer2":"scene/forest/layer2.png","forest.layer3":"scene/forest/layer3.png"};class w{total;progress=0;current=0;static __instance;static _initialized=!1;static _progressCallback;static _errorCallback;sprite={};constructor(){this.total=Object.keys(z).length,this.initialize()}countOne=()=>{this.current+=1,this.progress=Math.floor(this.current/this.total*100),w._progressCallback(this.progress)};loadGif=(e,s)=>{setTimeout(()=>{const n=Ee();return n.onerror=function(a){console.log("Gif loading error "+a.type),w._errorCallback&&w._errorCallback(`Img loading error: ${a.type}`)},n.onloadall=()=>{this.countOne()},n.load(s),this.sprite[e]=n,n},0)};loadImg=(e,s)=>{const n=document.createElement("img");return n.src=s,n.onload=()=>{this.countOne()},n.onerror=function(a){console.log("Img loading error:",a),w._errorCallback&&w._errorCallback(`Img loading error: ${e}`)},_e(this.sprite,e,n),n};initialize=()=>{if(!w._initialized){const e=Object.keys(z);for(const s of e){const n=z[s],a=n.split(".").pop(),o=`${Ce}/${n}`;switch(a){case"gif":{this.loadGif(s,o);break}case"png":{this.loadImg(s,o);break}}}}};static get(e,s){return w.__instance?w.__instance:(e&&(w._progressCallback=e),s&&(w._errorCallback=s),w.__instance=new w)}}const M={width:1280,height:576},q={cat:{width:252,height:144}},ke={version:"alpha.0.2.11",scorePerLevel:1e3,catchRange:24,actionPositionVertical:Math.floor(M.height*.88),trajectoryStep:3,jumpHeightMin:Math.floor(q.cat.height/1.5),jumpHeightMax:q.cat.height*2.25,defaultCatX:Math.floor(M.width/3),get defaultCatY(){return this.actionPositionVertical+q.cat.height*.05},defaultTargetX:M.width/2,animalPositionDelta:M.width/8,get defaultTargetY(){return this.actionPositionVertical},defaultTargetHeight:128,defaultRunAwayDelay:8e3},xe=["mouse","grasshopper","butterfly","bird"],Te=["cactus1","cactus2","puddle","boulder","flowerpot","gnome","bucket"],U=["autumn","cliff","desert","forest","jungle","lake","mountains"],it={autumn:["mouse","bird","puddle","flowerpot","boulder"],cliff:["butterfly","grasshopper","flowerpot","boulder","gnome"],desert:["butterfly","mouse","cactus1","cactus2"],forest:["butterfly","grasshopper","bird","puddle","boulder"],jungle:["butterfly","grasshopper","bird","puddle","boulder","cactus1"],lake:["mouse","bird","puddle","flowerpot","gnome"],mountains:["mouse","grasshopper","puddle","flowerpot","gnome"],default:[...xe,...Te]},lt={none:{success:0,fail:0},butterfly:{success:10,fail:0},grasshopper:{success:10,fail:0},frog:{success:10,fail:-5},bird:{success:10,fail:-5},mouse:{success:10,fail:-10},puddle:{success:5,fail:-5},boulder:{success:5,fail:-5},flowerpot:{success:10,fail:-10},bucket:{success:5,fail:-10},gnome:{success:5,fail:-10},cactus1:{success:5,fail:-20},cactus2:{success:5,fail:-20}},ct={newGame:"Hold space/tap to jump",firstAnimal:"Need to jump on target",firstBarrier:"Need to jump over the target",firstTimeout:"The animal can run away"},Le="_weather_layer_1c903_1",Se="_weather__leaf_1c903_12",te={weather_layer:Le,weather__leaf:Se},Fe="./images/leaf_brown.svg";class Pe{container;leaves=[];isDestroyed=!1;constructor(e={}){const{leafCount:s=3}=e;this.container=document.createElement("div"),this.container.className=te.weather_layer;for(let n=0;n<s;n++)this.addLeaf()}createWeatherLeaf(){const e=document.createElement("img");return e.src=Fe,e.className=te.weather__leaf,e.animationData={horizontalSpeed:Math.floor(1e4+Math.random()*1e4),rotationSpeed:Math.floor((Math.random()*3+2)*10)/10,swirlFrequency:.5+Math.random()*1,swirlAmplitude:10+Math.random()*20},e}addLeaf(){const e=this.createWeatherLeaf();this.container.appendChild(e),this.leaves.push(e),this.setRandomLeafProperties(e),this.animateLeaf(e)}setRandomLeafProperties(e){const s=90-Math.pow(Math.random(),2)*85;e.style.top=`${s}%`,e.style.left="0";const n=20+Math.random()*15;e.style.width=e.style.height=`${n}px`}animateLeaf(e){if(this.isDestroyed)return;const s=e.animationData,n=[{transform:"translateX(0) rotate(0deg)"},{transform:`translateX(100vw) rotate(${-s.rotationSpeed*360}deg)`}],a={duration:s.horizontalSpeed,iterations:1,fill:"forwards"};e.animation=e.animate(n,a),e.animation.onfinish=()=>{this.isDestroyed||(this.setRandomLeafProperties(e),this.animateLeaf(e))}}addLeaves(e=1){if(!this.isDestroyed)for(let s=0;s<e;s++)this.addLeaf()}removeLeaves(){this.isDestroyed||(this.leaves.forEach(e=>{e.animation&&e.animation.cancel(),e.remove()}),this.leaves=[])}destroy(){this.isDestroyed||(this.removeLeaves(),this.container.remove(),this.isDestroyed=!0)}get leafCount(){return this.leaves.length}pause(e){e?this.leaves.forEach(s=>{s.animation&&s.animation.pause()}):this.leaves.forEach(s=>{s.animation&&s.animation.play()})}get element(){return this.container}}const Ae="_button_dli2k_1",Me="_circle_dli2k_11",Ne="_inner_dli2k_23",H={button:Ae,circle:Me,inner:Ne},j=l=>{const e=document.createElement("div");e.className=H.button;const s=document.createElement("div");s.className=H.circle;const n=document.createElement("div");n.className=H.inner;const a=document.createElement("img");return a.src=l,n.append(a),e.append(s,n),e},Ie="_pause_layer_thw7a_1",Oe="_pause__header_thw7a_14",$e="_pause__btns_thw7a_25",R={pause_layer:Ie,pause__header:Oe,pause__btns:$e},W={resume:"./icons/play.svg",restart:"./icons/restart.svg",menu:"./icons/menu.svg"};class Be{container;pause;restart;menu;constructor({pause:e,restart:s,menu:n}){this.container=document.createElement("div"),this.container.className=R.pause_layer,this.pause=e,this.restart=s,this.menu=n,this.init()}show=e=>{this.container.setAttribute("style",e?"display: flex;":"display: none;")};init=()=>{const e=document.createElement("div");e.className=R.pause__inner;const s=document.createElement("h2");s.className=R.pause__header,s.textContent="Pause";const n=document.createElement("div");n.className=R.pause__btns;const a=j(W.resume);a.addEventListener("click",this.handleResume);const o=j(W.restart);o.addEventListener("click",this.handleRestart);const c=j(W.menu);c.addEventListener("click",this.handleMenu),n.append(a,o,c),e.append(s,n),this.container.append(e),this.container.addEventListener("click",u=>{const{target:g,currentTarget:d}=u;g===d&&(u.preventDefault(),this.handleResume())})};handleResume=()=>{this.show(!1),this.pause(!1)};handleRestart=()=>{this.show(!1),this.restart()};handleMenu=()=>{this.show(!1),this.menu()};get element(){return this.container}}const Re={butterfly:"./spoil/butterfly.svg",grasshopper:"./spoil/frog.svg",frog:"./spoil/frog.svg",mouse:"./spoil/mouse.svg",bird:"./spoil/bird.svg"},Y=["butterfly","grasshopper","mouse","bird"],je=l=>Y.includes(l);class De{container;count={butterfly:0,grasshopper:0,frog:0,mouse:0,bird:0};slot={};constructor(e){e&&(this.count={...e}),this.container=document.createElement("div");for(const s of Y){const{slot:n,value:a}=this.createSlot(s);this.slot[s]=a,this.container.append(n)}}setCount(e){this.count={...e}}handleUpdate=e=>{je(e)&&(this.count[e]+=1,this.slot[e].innerText=this.count[e].toString())};handleReset=()=>{for(const e of Y)this.count[e]=0,this.slot[e].innerText="0"};createSlot=e=>{const s=document.createDocumentFragment(),n=document.createElement("img");n.src=Re[e],n.width=n.height=20;const a=document.createElement("span");return a.innerText=this.count[e].toString(),a.setAttribute("style","vertical-align: text-bottom; margin-left: 0.25rem; margin-right: 0.5rem;"),s.append(n,a),{slot:s,value:a}};get element(){return this.container}}const D={catch:{url:"./audio/catch.ogg",type:"single"},combo:{url:"./audio/combo.ogg",type:"single"},impact:{url:"./audio/impact.ogg",type:"single"},jump:{url:"./audio/jump.ogg",type:"single"}},oe=[{name:"Mountains",url:"./audio/mountains.mp3"}],se=Object.keys(D).length+oe.length*2;class O{static _instance;_sound={volume:.5,muted:!1};_music={volume:.45,muted:!0};sounds={};tracks=[];loaded=0;ready=0;pending=-1;playing=null;startPlayCallback;exceptionCallback;readyCallback;constructor(){if(O._instance)return O._instance;O._instance=this,Object.keys(D).forEach(e=>{const{url:s,type:n}=D[e];this.getSound(s,e,n)}),oe.forEach(e=>this.getSound(e.url,e.name,"music")),this.handleCanplay=this.handleCanplay.bind(this),this.handleEnded=this.handleEnded.bind(this)}set musicVolume(e){this._music.volume=e,this.playing&&(this.playing.audio.volume=e)}set musicMute(e){this._music.muted=e,this.playing?this.playing.audio.muted=e:this.play(0,!0)}set mute(e){this._sound.muted=e,this.musicMute=e}get muted(){return this._sound.muted||this._music.muted}get music(){return this._music}get sound(){return this._sound}play(e,s){if(this._music.muted||e===-1)return;const n=this.tracks[e];if(!n||!n.ready){this.pending=e;return}const a=this.tracks[e].audio;a.volume=this._music.volume,a.muted=this._music.muted,a.play().then(()=>{s&&a.addEventListener("ended",this.handleEnded),this.playing={track:e,audio:a},this.startPlayCallback&&this.startPlayCallback(this.tracks[e].name)}).catch(o=>{o.name==="NotAllowedError"?(this.pending=e,this.waitForUserInteraction().then(()=>{this.play(this.pending,!0)})):(this._music.muted=!0,this.exceptionCallback&&this.exceptionCallback(o instanceof Error?o.message:o.toString()))})}pause=()=>{this.playing?.audio.pause()};use(e){if(!this._sound.muted){if(!Object.keys(D).includes(e)){console.warn(`No sound: ${e}`);return}for(let s=0;s<10;s+=1){const n=this.sounds[e][s];if(n.currentTime===0||n.ended){n.volume=this._sound.volume,n.play().catch(a=>console.error(a));return}}}}getSound(e,s,n){const a=this,o=new Request(e,{method:"GET",headers:{"Accept-Ranges":"1000000000"},referrerPolicy:"no-referrer"});fetch(o).then(async function(c){const u=await c.blob(),g=window.URL.createObjectURL(u);if(a.loaded+=1,a.ready=~~(a.loaded/se*100),n==="music"){const d=new Audio;d.src=g,d.musicInfo={name:s,track:a.tracks.length},d.addEventListener("canplay",a.handleCanplay),a.tracks.push({name:s,audio:d,ready:!1})}else a.sounds[s]=Array.from({length:n==="multiple"?10:1},()=>{const d=new Audio;return d.src=g,d});a.readyCallback&&a.readyCallback(a.ready,s)})}handleCanplay(e){const s=e.target;if(s){s.removeEventListener("canplay",this.handleCanplay);const{name:n,track:a}=s.musicInfo;this.loaded+=1,this.ready=~~(this.loaded/se*100),this.tracks[a].ready=!0,this.pending===a&&(this.play(this.pending,!0),this.pending=-1),this.readyCallback&&this.readyCallback(this.ready,n)}}handleEnded(){if(!this.playing)return;let e=(this.playing.track??0)+1;e>=this.tracks.length&&(e=0),this.playing=null,this.play(e,!0)}waitForUserInteraction(){return new Promise(e=>{const s=["click","keydown","touchstart"];let n=!1;const a=()=>{n||(n=!0,s.forEach(o=>{document.removeEventListener(o,a)}),e())};s.forEach(o=>{document.addEventListener(o,a,{passive:!0})})})}}async function Ge(l){const e=l||document.documentElement,s=document;if(s.fullscreenEnabled||s.mozFullScreenEnabled||s.webkitFullscreenEnabled)try{e.requestFullscreen?await e.requestFullscreen():e.mozRequestFullScreen?await e.mozRequestFullScreen():e.webkitRequestFullscreen?await e.webkitRequestFullscreen():e.msRequestFullscreen&&await e.msRequestFullscreen()}catch(a){console.error("Error activating fullscreen:",a)}}async function Ve(){const l=document;l.exitFullscreen?await l.exitFullscreen():l.mozCancelFullScreen?await l.mozCancelFullScreen():l.webkitExitFullscreen&&await l.webkitExitFullscreen()}function re(){const l=document;return!!(l.fullscreenElement||l.mozFullScreenElement||l.webkitFullscreenElement)}async function ze(l,e=document.documentElement){l?await Ge(e):re()&&await Ve()}const qe="_overlay_layer_w4uf2_1",Ue="_row_w4uf2_18",He="_middle_w4uf2_29",We="_player_w4uf2_33",Xe="_combo_w4uf2_39",Ke="_btn_w4uf2_43",F={overlay_layer:qe,row:Ue,"bot-right":"_bot-right_w4uf2_23",middle:He,player:We,combo:Xe,btn:Ke},A={fullscreen:"./icons/fullscreen.svg",fullscreenExit:"./icons/fullscreen-exit.svg",pause:"./icons/pause.svg",soundOn:"./icons/sound-on.svg",soundOff:"./icons/sound-off.svg"};class Ye{container;upper;middle;bottom;constructor(){this.container=document.createElement("div"),this.container.className=F.overlay_layer,this.upper=document.createElement("div"),this.upper.className=F.row,this.middle=document.createElement("div"),this.middle.className=F.middle;const e=document.createElement("div");this.bottom=document.createElement("div"),this.bottom.className=F.row,this.container.append(this.upper,this.middle,e,this.bottom)}createButton=({src:e})=>{const s=document.createElement("div"),n=document.createElement("img");return n.src=e,n.width=n.height=40,s.append(n),s.className=F.btn,s};get element(){return this.container}}class Je extends Ye{sound;caught;player;constructor({handlePause:e}){super(),this.sound=new O,this.caught=new De;const s=document.createElement("div"),n=document.createElement("span");s.className=F.player,n.innerText="1",s.append("Level: ",n);const a=document.createElement("div"),o=document.createElement("span");a.className=F.player,o.innerText="0",a.append("Score: ",o);const c=document.createElement("div");c.className=F.combo,c.setAttribute("style","display: none;");const u=document.createElement("span");u.innerText="x0",c.append("Combo: ",u);const g=document.createElement("div");g.append(s,a,c),this.player={level:n,score:o,combo:u};const d=this.createButton({src:this.sound.muted?A.soundOn:A.soundOff}),p=d.children[0];d.addEventListener("mousedown",S=>{S.stopPropagation(),this.handleSoundToggle(p)}),this.upper.append(g,this.caught.element,d);const y=this.createButton({src:A.pause});y.addEventListener("mousedown",S=>{S.stopPropagation(),e(!0)});const v=document.createElement("div");v.className=F["bot-right"];const E=document.createElement("div");E.innerText=ke.version;const T=this.createButton({src:A.fullscreen}),P=T.children[0];T.addEventListener("mousedown",S=>{S.stopPropagation(),this.handleFullscreenToggle(P)}),v.append(E,T),this.bottom.append(y,v)}handleLevel=e=>{this.player.level.innerText=(e+1).toString()};handleScore=e=>{this.player.score.innerText=e.toString()};handleCombo=e=>{this.player.combo.innerText=`x${e}`;const s=this.player.combo.parentElement;e?s?.setAttribute("style","display: block;"):s?.setAttribute("style","display: none;")};handleTooltip=e=>{this.middle.innerText=e};handleSoundToggle=e=>{const s=this.sound.muted;this.sound.mute=!s,e.src=s?A.soundOff:A.soundOn};handleFullscreenToggle=e=>{const s=re(),n=document.querySelector("main");n&&(ze(!s,n),e.src=s?A.fullscreen:A.fullscreenExit)}}const Qe="_menu_layer_2d7dk_1",Ze="_thumb_2d7dk_20",et="_scene_2d7dk_33",X={menu_layer:Qe,thumb:Ze,scene:et},tt={play:"./icons/play.svg"},ie="./thumb",J=100,ne=J*(4/3),K=20;class st{container;thumbs=[];scene;constructor(){this.container=document.createElement("div"),this.container.className=X.menu_layer,this.container.setAttribute("style","display: none;");const e=Math.PI/2/(U.length-1),s=M.width-ne,n=M.height-J-K*2;for(let u=U.length-1;u>=0;u-=1){const g=U[u],d=document.createElement("img");d.className=X.thumb,d.src=`${ie}/${g}.jpg`,d.width=ne,d.height=J;const p=Math.PI*1-u*e,y=K+s/2+Math.floor(Math.cos(p)*s/2),v=K+Math.floor(Math.sin(p)*n);d.setAttribute("style",`top: ${v}px; left: ${y}px;`),this.thumbs.push({img:d,name:g}),this.container.append(d)}const a=document.createElement("div");a.className=X.scene;const o=document.createElement("div"),c=j(tt.play);o.append(c),a.append(o),this.scene={element:a,inner:o,btn:c,name:"default"},this.container.append(a)}show=(e=!0)=>{this.container.setAttribute("style",`display: ${e?"block":"none"};`)};get element(){return this.container}}class nt extends st{constructor({start:e}){super(),this.thumbs.forEach(s=>{s.img.addEventListener("click",this.handleSceneClick(s.name))}),this.scene.btn.addEventListener("click",()=>{console.log(this.scene.name),this.scene.element.setAttribute("style","display: none;"),e(this.scene.name)}),this.scene.element.addEventListener("click",s=>{const{target:n,currentTarget:a}=s;n===a&&(s.preventDefault(),this.scene.element.setAttribute("style","display: none;"))})}handleSceneClick=e=>s=>{const n=s.currentTarget;n.style.pointerEvents="none",n.offsetHeight,setTimeout(()=>{n.style.pointerEvents=""},0),this.scene.name=e,this.scene.element.setAttribute("style","display: flex;"),this.scene.inner.setAttribute("style",`width: 400px; height: 300px; background-image: url(${ie}/${e}.jpg)`)}}class at{root;game;loader;loaderBar;loaderValue;message;errors=[];constructor(){const e=document.querySelector("#app");if(e){this.root=e;const s=document.createElement("main");s.className="main",this.game=document.createElement("div"),this.game.className="game",s.append(this.game),this.root.append(s)}else throw new Error("Root element not found")}loaderInit(){this.loader=document.createElement("div"),this.loader.classList.add("loader_layer");const e=document.createElement("div");e.classList.add("loader"),this.loaderBar=document.createElement("div"),this.loaderBar.classList.add("loader__bar"),this.loaderValue=document.createElement("div"),this.loaderValue.classList.add("loader__value"),e.append(this.loaderBar,this.loaderValue),this.loader.append(e),this.message=document.createElement("div"),this.message.classList.add("loader__message"),this.game.append(this.loader,this.message)}loaderRemove(){this.loader&&this.loader.remove(),this.message&&(this.errors.length||this.message.remove())}loaderUpdate(e){this.loaderValue&&this.loaderBar&&(this.loaderValue.innerText=`${e}%`,this.loaderBar.setAttribute("style",`width: ${e}%;`))}}class ot extends at{loading={start:0};pause;overlay;weather;menu;engineStart;constructor(){super(),this.menu=new nt({start:this.startGame}),this.game.append(this.menu.element)}init=async()=>{this.loaderInit(),this.game.addEventListener("contextmenu",n=>(n.preventDefault(),!1)),this.loading.start=Date.now();const e=n=>{this.loaderUpdate(n),n===100&&(console.log(`\x1B[33m${s.total}\x1B[0m assets loaded in \x1B[33m${Date.now()-this.loading.start}ms\x1B[0m`),this.handleLoadComplete())},s=w.get(e,this.onError({source:"assets"}))};handleLoadComplete=()=>{this.loaderRemove(),!this.errors.length&&this.menu.show()};initGame=async()=>{const e=document.createElement("canvas");e.width=M.width,e.height=M.height,e.className="game_layer",e.setAttribute("style","z-index: 1");const{Engine:s}=await ve(async()=>{const{Engine:o}=await import("./engine-D6J300Va.js");return{Engine:o}},[],import.meta.url),n={handlePause:this.handlePause,handleGameOver:()=>console.log("Handle game over"),setLevel:o=>this.overlay?.handleLevel(o),setCombo:o=>this.overlay?.handleCombo(o),updateScore:o=>this.overlay?.handleScore(o),updateCaught:o=>this.overlay?.caught.handleUpdate(o),resetCaught:()=>this.overlay?.caught.handleReset(),showTooltip:o=>this.overlay?.handleTooltip(o)},a=s.get({ctx:e.getContext("2d"),handlers:n});this.overlay=new Je({handlePause:a.pause}),this.weather=new Pe,this.pause=new Be({pause:o=>{a.pause(o),this.weather?.pause(o)},restart:()=>{a.start({restart:!0}),this.weather?.pause(!1)},menu:()=>{a.stop(),this.menu.show()}}),this.game.append(e,this.overlay.element,this.weather.element,this.pause.element),this.engineStart=(o="default")=>a.start({levelName:o})};startGame=e=>{this.menu.show(!1),this.weather?.pause(!1),this.engineStart?this.engineStart(e):this.initGame().then(()=>this.engineStart(e))};handlePause=e=>{this.pause?.show(e),this.weather?.pause(e)};onError=({source:e})=>s=>{const n=Date.now()-this.loading.start;if(this.errors.push({source:e,message:s,lapse:n}),console.error(s,`(${n}ms)`),this.message){const a=document.createElement("div");a.innerText=s,this.message.appendChild(a)}}}new ot().init();export{xe as A,Te as B,M as C,ke as G,w as R,q as S,ct as T,O as a,lt as b,it as c,rt as g};
